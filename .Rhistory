cd.v.it <- project(cd.v, "EPSG:6371")
py.it <- project(py, "EPSG:6371")
plot(py.it); points(cd.v.it)
f <- list.files("../Current/Current/", pattern = ".tif", full.names = T)
length(f)
r <- rast(f)
riq <- sum(r)
plot(riq)
library(maptools)
data("wrld_simpl")
m <- vect(wrld_simpl)
m <- project(m, "EPSG:4326")
plot(m)
riq <- project(riq, "EPSG:4326")
riq.ter <- mask(riq, m.ea)
riq.ter <- mask(riq, m)
plot(riq.ter)
bio <- rast(paste0("../Current/bio",c(1, 7, 12), ".tif"))
bio.res <- resample(bio, riq, method = "lanczos")
bio.res <- mask(bio.res, m)
plot(bio.res)
plot(m)
riq.df <- as.data.frame(riq, xy = T)
riq.df$sum <- round(riq.df$sum, 0)
knitr::kable(head(riq.df))
riq.88 <- project(riq.ter, "EPSG:8857")
bio.88 <- project(bio.res, "EPSG:8857")
rast(bio.88, riq.88)
c(bio.88, riq.88)
todos <- c(bio.88, riq.88)
riq.df <- as.data.frame(riq.88, xy = T)
riq.df$sum <- round(riq.df$sum, 0)
knitr::kable(head(riq.df))
todos <- c(bio.88, riq.88)
riq.df <- as.data.frame(todos, xy = T)
riq.df$sum <- round(riq.df$sum, 0)
knitr::kable(head(riq.df))
library(ggplo2)
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum))
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum))+
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum))+
labs(y = "Riqueza")
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio7, y = sum))+
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio12, y = sum))+
labs(y = "Riqueza")
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
geom_smooth(aes(x = bio1 + y = sum), method = "gam") +
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
geom_smooth(aes(x = bio1 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio7, y = sum)) +
geom_smooth(aes(x = bio7 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio12, y = sum)) +
geom_smooth(aes(x = bio12 , y = sum), method = "gam")+
labs(y = "Riqueza")
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
geom_smooth(aes(x = bio1 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio7, y = sum)) +
geom_smooth(aes(x = bio7 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio12, y = sum)) +
geom_smooth(aes(x = bio12 , y = sum), method = "gam")+
labs(y = "Riqueza")
m1 <- glm(sum ~ bio1 + bio7 + I(bio7^2) +
bio12 + I(bio12^2),
data = riq.df, family = "poisson")
m1 <- glm(sum ~ bio1 + bio7 + I(bio7^2) +
bio12 + I(bio12^2),
data = riq.df, family = "poisson")
summary(m1)
p <- predict(m1)
riq.df$pred.riq <- p
riq.pred <- rast(riq.df)
plot(riq.pred[["pred.riq"]])
library(dismo); library(terra); library(rgdal); library(maptools)
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
brad.p
brad.sp <- brad.p
coordinates(brad.sp) <- ~ lon+lat
brad.sp <- vect(brad.sp)
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.p$lon, brad.p$lat)
plot(buf, add = T)
buf <- rgeos::gBuffer(brad.sp, byid = F, width = 10)
buf <- buffer(brad.sp, byid = F, width = 10)
buf <- buffer(brad.sp, width = 10)
plot(bur)
plot(buf)
buf <- buffer(brad.sp, width = 100)
plot(buf)
buf <- buffer(brad.sp, width = 1000)
plot(buf)
buf <- buffer(brad.sp, width = 10000)
plot(buf)
buf <- buffer(brad.sp, width = 100000)
plot(buf)
buf <- buffer(brad.sp, width = 1000000)
plot(buf)
buf <- buffer(brad.sp, width = 500000)
plot(buf)
buf <- buffer(brad.sp, width = 1000000)
plot(buf)
buf <. union(buf)
buf <- union(buf)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.p$lon, brad.p$lat)
plot(buf, add = T)
capas.rm <- crop(mask(capas.r, buf), extent(buf))
crs(capas.r)
capas.r <- project(capas.r, "EPSG:4326")
plot(capas.r)
buf <- project(buf, "EPSG:4326")
capas.rm <- crop(mask(capas.r, buf), extent(buf))
capas.rm <- crop(mask(capas.r, buf), buf)
plot(capas.rm[[1]])
points(brad.sp)
pres.r <- rasterize(brad.sp, capas.rm[[1]], fun = "count")
pres.r[[1]][is.na(pres.r[[1]][])] <- 0
pres.r <- mask(pres.r[[1]], capas.rm[[1]])
plot(pres.r)
capas.rm <- c(capas.rm, pres.r)
capas.df <- as.data.frame(capas.rm)
wt <- rep(1.0E-6, nrow(capas.df))
names(capas.df)
capas.df <- as.data.frame(capas.rm, xy = T)
wt <- rep(1.0E-6, nrow(capas.df))
wt[capas.df$ID == 0] = length(wt)/sum(capas.df$count == 0)
modelo <- glm(ID/wt ~ bio1 + bio12 + bio7 +
I(bio1^2) + I(bio12^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
modelo <- glm(count/wt ~ bio1 + bio12 + bio7 +
I(bio1^2) + I(bio12^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
modelo.1 <- glm(ID/wt ~ bio1 + bio16 + bio17 + bio7 +
I(bio1^2) + I(bio16^2)+ I(bio17^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
modelo.1 <- glm(count/wt ~ bio1 + bio16 + bio17 + bio7 +
I(bio1^2) + I(bio16^2)+ I(bio17^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
mod.step <- step(modelo.1)
summary(mod.step)
pred.modelo <- exp(predict(mod.step))
pred.r <- rasterFromXYZ(data.frame(capas.df[, c("x", "y")], pred.modelo))
plot(pred.r)
pred.r <- rast(data.frame(capas.df[, c("x", "y")], pred.modelo))
plot(pred.r)
points(brad.sp, pch = 20, cex = 0.1)
fav.pres <- extract(pred.r, brad.sp)
umbral <- quantile(fav.pres, 0.05)
fav.pres <- extract(pred.r, brad.sp)
fav.pres
umbral <- quantile(fav.pres$pred.modelo, 0.05)
umbral
plot(pred.r > umbral); points(brad.sp)
brad.sp <- vect(brad.p[, c("lon", "lat")])
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
library(dismo); library(terra)
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
brad.sp <- vect(brad.p[, c("lon", "lat")])
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
buf <- buffer(brad.sp, width = 1000000)
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
brad.sp <- vect(brad.p[, c("lon", "lat")])
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
mundo <- project(mundo, "EPSG:8857")
capas.r <- project(capas.r, "EPSG:8857")
brad.sp <- project(brad.sp, "ESPG:8857")
buf <- buffer(brad.sp, width = 1000000)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.p$lon, brad.p$lat)
plot(buf, add = T)
plot(capas.r[[1]]); points(brad.sp)
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
brad.sp <- project(brad.sp, "ESPG:8857")
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
system.file(package="dismo")
paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
brad.sp <- vect(brad.p[, c("lon", "lat")])
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
mundo <- project(mundo, "EPSG:8858")
capas.r <- project(capas.r, "EPSG:8858")
brad.sp <- project(brad.sp, "ESPG:8858")
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
plot(capas.r[[1]])
points(brad.sp)
mundo <- project(mundo, "ESRI:54034")
plot(mundo)
mundo <- project(mundo, "IAU_2015:39985")
plot(mundo)
mundo <- project(mundo, "IAU_2015:39986")
plot(mundo)
mundo <- project(mundo, "ESRI:56036")
mundo <- project(mundo, "ESRI:53036")
plot(mundo)
mundo$SUBREGION
mundo$UN
mundo$ISO2
mundo$ISO3
mundo$
mundo <- project(mundo, "ESRI:53036")
mundo$FIPS
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
plot(capas.})
plot(capas.r)
brad.f <- paste(system.file(package="dismo"), "/ex/bradypus.csv", sep="")
brad.p <- read.csv(brad.f)
brad.sp <- vect(brad.p[, c("lon", "lat")])
mundo <- vect("Datos/Mundo.gpkg")
plot(mundo)
crs(brad.sp) <- crs(mundo)
capas.f <- list.files(path=paste(system.file(package="dismo"), '/ex',
sep=''), pattern='grd', full.names=TRUE )
capas.r <- rast(capas.f)
par(mar = c(1,1,1,1))
plot(capas.r[[1]])
points(brad.sp)
mundo <- project(mundo, "ESRI:53036")
plot(mundo)
pro <- "ESRI:53036"
mundo <- project(mundo, pro)
plot(mundo)
capas.r <- project(capas.r, pro)
plot(capas.r)
brad.sp <- project(brad.sp, pro)
buf <- buffer(brad.sp, width = 1000000)
par(mar = c(1,1,1,1))
plot(capas.r[[1]]); points(brad.sp)
plot(buf, add = T)
capas.rm <- crop(mask(capas.r, buf), buf)
plot(capas.rm[[1]])
points(brad.sp)
pres.r <- rasterize(brad.sp, capas.rm[[1]], fun = "count")
pres.r[[1]][is.na(pres.r[[1]][])] <- 0
pres.r <- mask(pres.r[[1]], capas.rm[[1]])
plot(pres.r)
capas.rm <- c(capas.rm, pres.r)
capas.df <- as.data.frame(capas.rm, xy = T)
wt <- rep(1.0E-6, nrow(capas.df))
wt[capas.df$ID == 0] = length(wt)/sum(capas.df$count == 0)
modelo <- glm(count/wt ~ bio1 + bio12 + bio7 +
I(bio1^2) + I(bio12^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
modelo.1 <- glm(count/wt ~ bio1 + bio16 + bio17 + bio7 +
I(bio1^2) + I(bio16^2)+ I(bio17^2) + I(bio7^2),
data = capas.df, weights = wt,
family = poisson())
mod.step <- step(modelo.1)
summary(mod.step)
pred.modelo <- exp(predict(mod.step))
pred.r <- rast(data.frame(capas.df[, c("x", "y")], pred.modelo))
plot(pred.r)
points(brad.sp, pch = 20, cex = 0.1)
fav.pres <- extract(pred.r, brad.sp)
umbral <- quantile(fav.pres$pred.modelo, 0.05)
plot(pred.r > umbral); points(brad.sp)
knitr::opts_chunk$set(echo = TRUE)
library(dismo)
sp <- gbif(genus = "Cachryx", species = "defensor")
class(sp)
class(sp)
knitr::kable(head(sp[, c("lon", "lat")]))
knitr::kable(tail(sp[, c("lon", "lat")]))
View(sp)
xy <- subset(sp, select = c("lon", "lat"))
xy.na <- na.omit(xy)
p <- with(xy.na, lon * lat)
xy.na$p <- p
p <- with(xy.na, lon * lat)
xy.na$p <- p
xy.unicos <- unique(xy.na)
dim(xy.unicos)
getwd()
library(maptools)
data("wrld_smpl")
data("wrld_simpl")
plot(wrld_simpl)
plot(wrld_simpl)
library(terra)
v <- vect("Datos/Peninsula.gpkg") #Importando área de estudio
xy.s <- vect(xy.unicos[, c("lat", "lon")])# transformando de df a vector
plot(v); points(xy.s)
e <- terra::extract(v, xy.s)
e
e.na <- which(!is.na(e$GID_0))
xy.corr <- xy.unicos[e.na, ]
plot(v); points(xy.corr[, c("lon", "lat")], pch = 20)
library(rinat)
sp1 <- get_inat_obs(taxon_name = "Cachryx defensor")
dim(sp1)
xy.1 <- subset(sp1, selec = c("longitude", "latitude"))
plot(v); points(xy.1, pch = 20)
dismo::gbif(genus = "Campylorhynchus", species = "yucatanicus")
cd <- dismo::gbif(genus = "Cachryx", species = "defensor")
ll <- subset(cd, select = c("lat", "lon"))
library(terra)
llsp <- vect(ll)
names(ll) <- c("Lat", "Lon")
library(terra)
llsp <- vect(ll)
p <- vect("~/Documentos/Proyectos/Estancias/Peninsula.gpkg")
p$NAME_1
s <- subset(p, NAME_1 == "Yucatán")
s <- subset(p, p$NAME_1 == "Yucatán")
plot(s)
knitr::opts_chunk$set(echo = TRUE)
library(rvertnet)
sp2 <- vertsearch("Cachryx defensor")
class(sp2)
class(sp2$data)
vertmap(sp3)
sp2$data
sp3 <- vertsearch("Ctenosaura similis")
vertmap(sp3)
xy.3 <- subset(sp3$data, select = c("decimallatitude", "decimallongitude"),
scientificname %in% c("Ctenosaura similis", "CTENOSAURA SIMILIS"))
View(sp3)
View(xy.3)
library(dismo)
sp <- gbif(genus = "Cachryx", species = "defensor")
xy <- subset(sp, select = c("lon", "lat"))
xy.na <- na.omit(xy)
xy <- subset(sp, select = c("lon", "lat"))
xy.na <- na.omit(xy)
p <- with(xy.na, lon * lat)
xy.na$p <- p
xy.unicos <- unique(xy.na)
dim(xy.unicos)
library(terra)
v <- vect("Datos/Peninsula.gpkg") #Importando área de estudio
xy.s <- vect(xy.unicos[, c("lat", "lon")])# transformando de df a vector
plot(v); points(xy.s)
e <- terra::extract(v, xy.s)
e.na <- which(!is.na(e$GID_0))
xy.corr <- xy.unicos[e.na, ]
plot(v); points(xy.corr[, c("lon", "lat")], pch = 20)
e <- terra::extract(v, xy.s)
e.na <- which(!is.na(e$GID_0))
xy.corr <- xy.unicos[e.na, ]
plot(v); points(xy.corr[, c("lon", "lat")], pch = 20)
write.csv(xy.corr, "Datos/Cachryx.csv", row.names = F)
writeVector(vect(xy.corr[, c("lon", "lat")]),
filename = "Datos/Cachryx.gpkg", filetype = "GPKG")
install.packages("rinat")
library(rinat)
sp1 <- get_inat_obs(taxon_name = "Cachryx defensor")
xy.1 <- subset(sp1, selec = c("longitude", "latitude"))
names(xy.corr)
names(xy.1)
names(xy.corr)
names(xy.1) <- c("lon", "lat")
todos <- rbind(xy.corr, xy.1)
names(xy.corr)
xy.1$p <- NA
todos <- rbind(xy.corr, xy.1)
head(todos)
knitr::opts_chunk$set(echo = TRUE)
library(rdryad)
id.dryad <- dryad_dataset(dois = "10.5061/dryad.bp26v20")
muestra <- sample(1:124830, 100)
muestra
muestra <- sort(sample(1:124830, 100))
muestra
id
id <- id.dryad$`10.5061/dryad.bp26v20`$id
id
knitr::opts_chunk$set(echo = TRUE)
library(terra); library(tidyr)
py <- vect("Datos/Peninsula.gpkg")
py |> as.data.frame()
crs(py, describe = T)
cd.csv <- read.csv("Datos/Cachryx.csv")
cd.gpkg <- vect("Datos/Cachryx.csv")
crs(cd.gpkg, describe = T)
crs(cd.gpkg, describe = T)
knitr::opts_chunk$set(echo = TRUE)
cd.v <- vect(cd.csv)
crs(cd.v) <- crs(py)
crs(cd.v, describe = T)
knitr::include_graphics("Tutorial-aplicaciones/Proyeccion.png", dpi = 150)
knitr::include_graphics("Tutorial-aplicaciones/EPSG-dialogo.png", dpi = 200)
cd.v.it <- project(cd.v, "EPSG:6371")
py.it <- project(py, "EPSG:6371")
plot(py.it); points(cd.v.it)
f <- list.files("../Current/Current/", pattern = ".tif", full.names = T)
length(f)
f <- list.files("Datos/Current/Current/", pattern = ".tif", full.names = T)
length(f)
length(f)
r <- rast(f)
plot(r[[400]])
riq <- sum(r)
plot(riq)
m <- vect("Datos/Mundo.gpkg")
m <- project(m, "EPSG:4326")
plot(m)
riq <- project(riq, "EPSG:4326")
riq.ter <- mask(riq, m)
plot(riq.ter)
bio <- rast("Datos/Chelsa-bio1-7-12.tif")
plot(bio)
bio.res <- resample(bio, riq, method = "lanczos")
bio.res <- mask(bio.res, m)
plot(bio.res)
m.88 <- project(m, "EPSG:8857")
riq.88 <- project(riq.ter, "EPSG:8857")
bio.88 <- project(bio.res, "EPSG:8857")
riq.88 <- mask(riq.88, m.88)
bio.88 <- mask(bio.88, m.88)
plot(riq.88)
todos <- c(bio.88, riq.88)
riq.df <- as.data.frame(todos, xy = T)
riq.df$sum <- round(riq.df$sum, 0)
knitr::kable(head(riq.df))
library(ggplot2)
ggplot(riq.df) + geom_point(aes(x = bio1, y = sum)) +
geom_smooth(aes(x = bio1 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio7, y = sum)) +
geom_smooth(aes(x = bio7 , y = sum), method = "gam") +
labs(y = "Riqueza")
ggplot(riq.df) + geom_point(aes(x = bio12, y = sum)) +
geom_smooth(aes(x = bio12 , y = sum), method = "gam")+
labs(y = "Riqueza")
m1 <- glm(sum ~ bio1 + bio7 + I(bio7^2) +
bio12 + I(bio12^2),
data = riq.df, family = "poisson")
m1 <- glm(sum ~ bio1 + bio7 + I(bio7^2) +
bio12 + I(bio12^2),
data = riq.df, family = "poisson")
summary(m1)
head(riq.df)
p <- predict(m1)
riq.df$pred.riq <- exp(p)
riq.df <- na.omit(riq.df)
knitr::kable(head(riq.df))
m1 <- glm(sum ~ bio1 + bio7 + I(bio7^2) +
bio12 + I(bio12^2),
data = riq.df, family = "poisson")
summary(m1)
p <- predict(m1)
riq.df$pred.riq <- exp(p)
riq.pred <- rast(riq.df)
par(mfrow = c(2, 1))
plot(riq.pred[["pred.riq"]], main = "Modelo")
plot(riq.pred[["sum"]], main = "Observada")
